#!/usr/bin/env bash
# Copyright 2015 Andrew Schwartzmeyer
set -eu

cwd=$(pwd)
cd ~

if ! hash git 2> /dev/null; then
    echo >&2 "Please install git" & exit 1
fi

echo "Pulling in ~/bin..."
if [[ ! -d bin ]]; then
    git clone git@suchcodemuchlove.com:dotfiles/bin.git bin
fi

PATH="$PATH:$HOME/bin"

echo "Backing up potentially conflicting files..."
CONFLICTS=".bash_profile .bash_logout .bashrc .gitconfig .gitignore_global .mrconfig .tmux.conf .zprofile .zshrc"
for file in $CONFLICTS; do
    if [[ ( -e $file ) && ( ! -e ${file}.orig ) ]]; then
	 mv $file ${file}.orig
    fi
done

echo "Pulling in dotfiles..."
# Note that vcsh and mr are in bin
if [[ ! -d .mr ]]; then
    git clone git@suchcodemuchlove.com:dotfiles/mr.git .mr
fi

if [[ ! -L .mrconfig ]]; then
    ln -s .mr/mrconfig .mrconfig
fi

mr checkout

cd $cwd
echo "Dotfiles bootstrapping complete! Reload session..."
