#!/bin/bash
# Copyright 2014 Andrew Schwartzmeyer
set -u

cd ~
if [[ ! -e ~/.ssh/id_rsa.pub ]]; then
    command -v ssh-keygen >/dev/null 2>&1 || { echo >&2 "Please install ssh-keygen"; exit 1; }
    ssh-keygen
    cat .ssh/id_rsa.pub
    read -p "Add SSH keys where needed! Press any key to continue... " -n1 -s
else
    echo "SSH key already exists, continuing..."
fi

command -v git >/dev/null 2>&1 || { echo >&2 "Please install git"; exit 1; }
git clone git@github.com:andschwa/bin.git
PATH="$PATH:$HOME/bin"

echo "Backing up conflicting files..."
CONFLICTS=".bashrc .gitconfig .gitignore_global .mrconfig .tmux.conf .zprofile .zshrc"
for FILE in $CONFLICTS; do
    [[ -e "${FILE}" ]] && mv "${FILE}" "${FILE}.orig"
done

echo "Pulling in dotfiles..."
# Note that vcsh and mr are in ~/bin
vcsh clone git@github.com:andschwa/dotfiles.git

mr update
vcsh run dotfiles git update-index --assume-unchanged LICENSE README.org
rm -f ~/LICENSE ~/README.org

echo "Dotfiles setup! Reload session to contine..."
